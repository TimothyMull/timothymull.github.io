= Ethernet LAN Switching

A Local Area Network (LAN) is a collection of devices within one physical location. It allows for shared communication between
devices and to the Internet. A business, school, or hospital may have multiple LANs all connected by a router. This allow communication
outside of the local network to other networks. LANs are found at Layer 2 of the OSI Model and define the concept of segmentation.

In order for businesses to connect hundereds of PCs and devices together they use network switches. At a basic level a switch connect devices together and enables them to communicate in a LAN.

Devices cannot communicate outside of the LAN without help from a Layer 3 device such as a router. Switches operate at Layer 2
and can communicate between each other (if there are not VLANs, however more on that later). Devices operating at the same 

== The Data Link Layer


Layer 2 or the Data Link Layer as found in the OSI Model is where LANs primarily operate in terms of Layer 2 functionality.
Layer 2 provides node-to-node connectivity between devices like PCs to switch and back to a PC. Within Layer 2 we find the
definition for how data is to be formatted before being set over the wire. This is also where Layer 1 physical errors can be corrected.
Layer 2 is like a boundary between Layer 3 and these layers each use a different addressing scheme.



ifdef::env-github[]
++++
<p align="center">
  <img width="800" height="1000" src="Pictures/csg25-02-osi-encapsulation.png">
</p>
<h4 align="center">Figure 1. OSI Encapsulation Process</h4>
++++
endif::[]

ifndef::env-github[]
[]
image::Pictures/csg25-02-osi-encapsulation.png[align=center]
endif::[]



In Figure 1 we see how data is encapsulated starting at the top left and moving down. Application layer data generally
comprises the top 3 layers; Application, Presentation, and Session. As network engineers we really only care about the
first 4 layers; Transport, Network, Data Link, and Physical as this is where a majority of network protocols operate.

* Thus, starting at Layer 4 as we move down the stack, a Layer 4 header is added. This header contains information
    related to the transport protocols being used. Primarily being either Transmission Control Protocol (TCP) or User Datagram Protocol (UDP).
    This Protocol Data Unit (PDU), once encapsulated, is now referred to as *segment*.

* Then a Layer 3 header is added containing information such as the source and destinaiton IP addresses.
    Once the segment is encapsulated by the new Layer 3 header it is referred to as a *packet*.

* Finally we find ourselves in Layer 2 which adds information such as the source and destinaiton MAC addresses.
    Notice that when the packet reaches Layer 2, a header and trailer are added.
    Once the packet has been encapsulated by the Layer 2 header and trailer it is referred to as *frame*.

* When frames move to Layer 1 they are converted to *bits* which travel via electrical signals over the transport medium.


== The Ethernet header

Lets dive a little deeper into the Layer 2 frame, specifically the Ethernet frame. This frame is meant to standardized
a format for data being transmitted over the physical Ethernet medium. This standardized format is specified in IEEE 802.3.

[cols="2, 1, 2, 2, 1, 4, 1, 2"]
|===

|Preamble
|SFD
|Destiantion MAC Address
|Source MAC Address
|EtherType/Length
|Payload
|>break<
|FCS

|===

=== Preamble - 7 bytes

The Preamble is a an alternating sequence of 1's and 0's (10101010) used to synchronize the receiving device's clock with
the incoming stream of data. 

=== Start Frame Delimeter (SFD) - 1 byte

The SFD is used to mark the end of the Preamble with another sequence of 1's and 0's (10101011). Notice how there is a 
1 at the end instead of a 0. This provides a signal to the receiving device that the Preamble is finished.

=== Destination MAC Address - 6 bytes

Specifies the destination of the receiving device.

=== Source MAC Address - 6 bytes

Specifies the source of the data.

=== EtherType/Length - 2 bytes

This field indicates the encapsulated protocol type or the size of the payload. If the size is below 1500 bytes this means
that the field will be labeled Length and indicate the size of the Ethernet frame payload. If the field is above 1536 bytes
then the field will be labeled as EtherType and indicate the protocol being used in the form of a hexadecimal value. Below are
some noteworthy hex values for the EtherType field.

[cols="1, 2"]
|===
| Hexadecimal
| Protocol

|0x0800
|IPv4

|0x0806
|ARP

|0x8100
|802.1Q

|0x86DD
|IPv6

|===

You can find plenty more on Wikipedia.

=== Payload

This is the data that is encapsulated within the frame and being transported.

=== Frame Check Sequence (FCS) - 4 bytes

This field is used to detect errors via a Cyclic Redundancy Check (CRC). The CRC is an FCS algorithm designed to detect
and discard frames. In order to determine if a frame has encountered an error the source node calculates a value based on the
origianl data. When the frame reacehs the destiation node, the received FCS number is checked against the received data.
When the CRC algortihmn is run, if the number is different, then the frame is discarded. 

== MAC Addresses

A Medium Access Control (MAC) address is a 6 byte hexadecimal number used as a unique identifier for a device's Network Interface Card (NIC).
This physical address is burned into the NIC by the manufactuer and it cannot be changed (usually). A MAC address contains two parts
the Organizational Unique Identifier (OUI) which is the first 3 bytes and the NIC specific identifier which is the last 3 bytes. MAC addresses can be Locally Administered Addresses (LAA)
or Universally Administered Addresses (UAA).

=== Univseral or Local

[cols="2, 4"]
|===

| UAA
| A UAA is typically hardcoded by the device manufactuer.
You can distinguish between a UAA and LAA by looking at the U/L bit (second-least-significant bit in the first octet).
If the bit is *0*, the address is universally significant.

| LAA
| A LAA is set by a network administrator or by software. This logically changes the burned-in MAC address. A LAA can be distinguished by again looking
    at the U/L bit. If the bit is *1*, the address is locally significant.

|===

=== MAC Address Table and Flooding

Within a network if one PC wants to talk to another PC traffic will need to go through a switch. Within the switch there is a MAC address table/Content Addressable Memory (CAM) table.
It stores the mappings between MAC addresses and which physical interface it received the address on. This enables the switch to forward frames associated with a destination MAC address.
If a MAC address is not found in the switch's MAC address table it is resolved through a process called *flooding*.

Flooding on a switch refers to the switch sending an *unknown-unicast frame* out of all of it's interfaces, except the one it received the frame on.
Frames that are sent to unintended recipients are discarded by those devices. The intended recipient will receive the frame and (hopefully) reply back. 
Once both MAC addresses are known by the switch, *known-unicast/unicast* frames are sent between hosts.

Everytime communication occurs between hosts the switch updates the aging timer. If a MAC-to-interface mapping ages out (timer expires), the entry is deleted.
Cisco switches removes dynamically learned MAC addreses after *5 minutes* of inactivity on the interface.

== Address Resolution Protocol (ARP)

ARP is used to discover Layer 2 MAC addresses when only the destiaation IP address is known. This enables the device wanting to send data to find the destination of
other devices on the LAN. Being a L2 protoocl, ARP is non-routable. ARP is also a request-response protocol. Something about request and response

